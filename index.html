<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SDS System v6.2</title>
    <style>
        :root { 
            --emerald-main: #4da699; --emerald-light: #e0f2f1; --emerald-dark: #2d6a61; 
            --bg: #f5fbfb; --card: #ffffff; --text: #334e4a; --input-bg: #ffffff;
            --border: #c8e6e1; --accent: #ff8a80;
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --emerald-main: #4da699; --emerald-light: #1c2b2b; --emerald-dark: #81cbc0;
                --bg: #0d1111; --card: #161d1d; --text: #d1dada; --input-bg: #0a0e0e; --border: #243333;
            }
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 400px; background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid var(--border); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        h1 { font-size: 1.1rem; color: var(--emerald-dark); text-align: center; margin: 0 0 15px 0; letter-spacing: 2px; }
        .section { margin-bottom: 12px; padding-top: 12px; border-top: 1px solid var(--border); }
        label { display: block; margin-bottom: 8px; font-size: 0.75rem; color: var(--emerald-main); font-weight: bold; }
        select, textarea, input { width: 100%; padding: 10px; background: var(--input-bg); color: var(--text); border: 2px solid var(--border); border-radius: 10px; font-size: 16px; appearance: none; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .opt-btn { background: var(--input-bg); padding: 12px 5px; border-radius: 8px; border: 2px solid var(--border); text-align: center; font-size: 0.8rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .opt-btn.active { background: var(--emerald-main); color: #fff; border-color: var(--emerald-main); }
        .opt-btn.accent.active { background: var(--accent); border-color: var(--accent); }
        .counter-wrap { text-align: right; font-size: 0.7rem; color: var(--emerald-main); margin-top: 4px; }
        .main-btn { width: 100%; padding: 16px; background: var(--emerald-main); color: #fff; border: none; border-radius: 10px; font-weight: bold; font-size: 1rem; margin-top: 10px; cursor: pointer; }
        #resultText { height: 160px; margin-top: 15px; border: 2px solid var(--emerald-main); background: var(--input-bg); color: var(--text); font-size: 0.85rem; resize: none; width: 100%; padding: 10px; border-radius: 10px; }
        .btn-copy { width: 100%; padding: 12px; background: var(--emerald-light); color: var(--emerald-dark); border: none; border-radius: 10px; margin-top: 10px; font-weight: bold; cursor: pointer; }
        .weekly-preview { font-size: 0.75rem; background: var(--emerald-light); padding: 8px; border-radius: 8px; margin-bottom: 8px; min-height: 20px; color: var(--emerald-dark); white-space: pre-wrap; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğ’ğƒğ’ ğ†ğ„ğğ„ğ‘ğ€ğ“ğğ‘ v6.3</h1>

    <div class="grid-2">
        <div>
            <label>TYPE</label>
            <select id="mode" onchange="updateUI()">
                <option value="OPEN">ã€é–‹åº—ã€‘OPEN</option>
                <option value="CALL">ã€å‘¼ã³è¾¼ã¿ã€‘CALL</option>
                <option value="WEEKLY">ã€å‘ŠçŸ¥ã€‘WEEKLY</option>
                <option value="RESERVE">ã€å‘ŠçŸ¥ã€‘RESERVE</option>
                <option value="INFO">ã€æ¡ˆå†…ã€‘INFO</option>
                <option value="CLOSED">ã€é–‰åº—ã€‘CLOSED</option>
            </select>
        </div>
        <div>
            <label>EVENT MODE</label>
            <select id="isEvent" onchange="updateUI()">
                <option value="é€šå¸¸">é€šå¸¸å–¶æ¥­</option>
                <option value="ç‰¹åˆ¥">ç‰¹åˆ¥ã‚¤ãƒ™ãƒ³ãƒˆ</option>
                <option value="CSV">CSVç›´æ¥èª­è¾¼</option>
            </select>
        </div>
    </div>

    <div id="reserveToggleSection" class="section" style="display:none">
        <label>TARGET LINK</label>
        <div class="grid-2">
            <div id="btnHP" class="opt-btn active" onclick="setLinkType('HP')">HPæ¡ˆå†…</div>
            <div id="btnForm" class="opt-btn" onclick="setLinkType('F')">äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ </div>
        </div>
    </div>

    <div class="section">
        <label>SCHEDULE</label>
        <div class="grid-2">
            <input type="date" id="openDate">
            <input type="text" id="openTime" placeholder="22:00ã€œ">
        </div>
        <input type="text" id="dateRange" placeholder="æœŸé–“æŒ‡å®šæ™‚ (ä¾‹: 2/15ã€œ2/21)" style="margin-top:8px">
    </div>

    <div id="weeklySection" style="display:none" class="section">
        <label>WEEKLY LIST</label>
        <div id="weeklyList" class="weekly-preview"></div>
        <div class="grid-2">
            <button type="button" class="opt-btn" onclick="addWeekly()">ãƒªã‚¹ãƒˆã«è¿½åŠ </button>
            <button type="button" class="opt-btn accent" onclick="clearWeekly()">ã‚¯ãƒªã‚¢</button>
        </div>
    </div>

    <div id="patternSection" class="section">
        <label>PHRASE PATTERN</label>
        <select id="bodyPattern"></select>
    </div>

    <div id="urlSection" style="display:none">
        <div class="section">
            <label>OFFICIAL HP URL</label>
            <input type="text" id="hpURL" value="https://piku.page/@SDS_FF14">
            <label style="margin-top:8px">RESERVATION URL</label>
            <input type="text" id="reserveURL" value="https://forms.gle/EiFinDpVuuoZjFKs7">
        </div>
    </div>

    <div class="section">
        <label>CAST</label>
        <div class="grid-2">
            <div class="opt-btn cast-btn" onclick="tgl(this)" data-val="å«‰å¦¬" data-emoji="ğŸ">ğŸ å«‰å¦¬</div>
            <div class="opt-btn cast-btn" onclick="tgl(this)" data-val="æš´é£Ÿ" data-emoji="ğŸ´">ğŸ´ æš´é£Ÿ</div>
            <div class="opt-btn cast-btn" onclick="tgl(this)" data-val="å‚²æ…¢" data-emoji="ğŸ‘‘">ğŸ‘‘ å‚²æ…¢</div>
            <div class="opt-btn cast-btn" onclick="tgl(this)" data-val="è‰²æ¬²" data-emoji="ğŸ¥€">ğŸ¥€ è‰²æ¬²</div>
        </div>
    </div>

    <div class="section">
        <label>LOCATION / STATUS</label>
        <select id="locType">
            <option value="Elemental Kujata ã‚¨ãƒ³ãƒ”ãƒ¬ã‚¢ãƒ ç¬¬4åŒº54ç•ªåœ°">Elemental Kujata ã‚¨ãƒ³ãƒ”ãƒ¬ã‚¢ãƒ ç¬¬4åŒº54ç•ªåœ°</option>
            <option value="Kujata ã‚¨ãƒ³ãƒ” 4-54">Kujata ã‚¨ãƒ³ãƒ” 4-54</option>
            <option value="">è¡¨è¨˜ãªã—</option>
        </select>
        <div class="grid-2" style="margin-top:8px">
            <div class="opt-btn status-btn accent" onclick="tgl(this)" data-val="ã€æº€å“¡å¾¡ç¤¼ã€‘">æº€å“¡</div>
            <div class="opt-btn status-btn accent" onclick="tgl(this)" data-val="ã€ç¾åœ¨ã€å³æ™‚ã”æ¡ˆå†…å¯èƒ½ã€‘">å³æ¡ˆå†…</div>
        </div>
    </div>

    <div class="section">
        <label>FREE MESSAGE</label>
        <textarea id="freeNote" rows="2"></textarea>
    </div>

    <button type="button" class="main-btn" onclick="generate()">æ–‡ç« ã‚’ç”Ÿæˆã™ã‚‹</button>
    <textarea id="resultText" readonly></textarea>
    <div class="counter-wrap">åˆè¨ˆ: <span id="totalCount">0</span> æ–‡å­—</div>
    <button type="button" class="btn-copy" onclick="copyText()">ã‚³ãƒ”ãƒ¼</button>
</div>

<script>
let masterPhrases = [];
let weeklyData = [];
let currentLinkType = 'HP'; 

// å®šæ•°ã®å®šç¾©ï¼ˆæœªå®šç¾©ã‚¨ãƒ©ãƒ¼å›é¿ï¼‰
const evMark = "â”€â”€â”€ âœ§ ğ’ğ©ğğœğ¢ğšğ¥ ğ„ğ¯ğğ§ğ­ âœ§ â”€â”€â”€";
const shopTag = "#SDS_FF14";

const pts = {
    OPEN: { é€šå¸¸: ["ä»Šå¤œã€è²´æ–¹ã‚’å¾…ã¡å—ã‘ã‚‹ã€Œç½ªã€ã®åŒ–èº«ãŸã¡ã€‚\n[CASTS]\næ¸‡ã„ãŸé­‚ã‚’æ½¤ã™ã€ç‰¹åˆ¥ãªã²ã¨æ™‚ã‚’ã€‚\nãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ã€‚"], ç‰¹åˆ¥: ["ä»Šå¤œã¯ç‰¹åˆ¥ãªå¤œã€‚ã„ã¤ã‚‚ã¨ã¯é•ã†ç½ªã®å½¢ã‚’ã€‚\n[CASTS]"] },
    CALL: { é€šå¸¸: ["[CASTS] ãŒã€ä»Šã™ãè²´æ–¹ã‚’ç”˜ã„æ‚¦æ¥½ã¸ã”æ¡ˆå†…ã„ãŸã—ã¾ã™ã€‚"], ç‰¹åˆ¥: ["ç‰¹åˆ¥ãªå®´ã€ã¾ã ãŠå¸­ãŒã”ã–ã„ã¾ã™ã€‚\n[CASTS]"] },
    RESERVE: { é€šå¸¸: ["ã€å…¬å¼HPã€‘\n[CASTS]\nğŸŒ [H_URL]"], ç‰¹åˆ¥: ["ç‰¹åˆ¥ã‚¤ãƒ™ãƒ³ãƒˆäºˆç´„å—ä»˜ä¸­ã€‚\n[CASTS]"] },
    INFO: { é€šå¸¸: ["ã€ğ’ğƒğ’ ğˆğ§ğŸğ¨ğ«ğ¦ğšğ­ğ¢ğ¨ğ§ã€‘\n[CASTS]"], ç‰¹åˆ¥: ["â”€â”€â”€ âœ§ ğ’ğ©ğğœğ¢ğšğ¥ ğ„ğ¯ğğ§ğ­ âœ§ â”€â”€â”€\n[CASTS]"] },
    CLOSED: { é€šå¸¸: ["ä»Šå¤œã‚‚ã”æ¥åº—ã€èª ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚\nè‰¯ã„æ‚ªå¤¢ã‚’ã€‚"], ç‰¹åˆ¥: ["ã‚¤ãƒ™ãƒ³ãƒˆå–¶æ¥­ã€ç„¡äº‹ã«çµ‚äº†ã„ãŸã—ã¾ã—ãŸã€‚ã”æ¥åº—æ„Ÿè¬ç”³ã—ä¸Šã’ã¾ã™ã€‚"] }
};

async function loadData() {
    try {
        const res = await fetch("phrases.csv");
        const text = await res.text();
        masterPhrases = text.split(/\r?\n/).filter(line => line.trim() !== "").map(row => {
            return row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(cell => cell.replace(/^"|"$/g, '').replace(/\\n/g, '\n').trim());
        }).slice(1);
        updateUI();
    } catch (e) { console.error("CSVèª­ã¿è¾¼ã¿å¤±æ•—:", e); updateUI(); }
}

function setLinkType(type) {
    currentLinkType = type;
    document.getElementById('btnHP').classList.toggle('active', type === 'HP');
    document.getElementById('btnForm').classList.toggle('active', type === 'F');
}

function tgl(el) { el.classList.toggle('active'); updateUI(); }

function updateUI() {
    const m = document.getElementById('mode').value;
    const isEv = document.getElementById('isEvent').value;
    const bodySelect = document.getElementById('bodyPattern');
    
    document.getElementById('weeklySection').style.display = (m === 'WEEKLY') ? 'block' : 'none';
    document.getElementById('urlSection').style.display = (m === 'RESERVE') ? 'block' : 'none';
    document.getElementById('reserveToggleSection').style.display = (m === 'RESERVE') ? 'block' : 'none';
    document.getElementById('patternSection').style.display = (m === 'WEEKLY') ? 'none' : 'block';

    if(m !== 'WEEKLY') {
        bodySelect.innerHTML = "";
        let options = [...(pts[m] ? (pts[m][isEv === 'ç‰¹åˆ¥' ? 'ç‰¹åˆ¥' : 'é€šå¸¸'] || pts[m]['é€šå¸¸']) : [])];
        
        // CSVã‹ã‚‰ã®å€™è£œè¿½åŠ 
        const csvOptions = masterPhrases.filter(p => p[0] === m && (isEv === 'CSV' || p[1] === isEv)).map(p => p[3]);
        
        const allOptions = [...new Set([...options, ...csvOptions])];
        allOptions.forEach(t => {
            const opt = document.createElement('option'); opt.value = t;
            opt.text = t.substring(0, 25).replace(/\n/g, ' ') + "...";
            bodySelect.appendChild(opt);
        });
    }
}

function addWeekly() {
    const dVal = document.getElementById('openDate').value;
    const tVal = document.getElementById('openTime').value;
    const dRange = document.getElementById('dateRange').value;
    let ds = dRange || (dVal ? `${new Date(dVal).getMonth()+1}/${new Date(dVal).getDate()}` : "");
    if(ds || tVal) { weeklyData.push(`${ds} ${tVal}`.trim()); document.getElementById('weeklyList').innerText = weeklyData.join('\n'); }
}

function clearWeekly() { weeklyData = []; document.getElementById('weeklyList').innerText = ""; }

function generate() {
    const mode = document.getElementById('mode').value;
    const isEv = document.getElementById('isEvent').value;
    const casts = Array.from(document.querySelectorAll('.cast-btn.active'));
    const castNames = casts.map(el => el.dataset.val);
    const castEmojis = casts.map(el => `${el.dataset.emoji}${el.dataset.val}`);
    
    let title = "ğˆğ§ğŸğ¨ğ«ğ¦ğšğ­ğ¢ğ¨ğ§";
    if (mode === 'OPEN') title = "ğğğ„ğ";
    else if (mode === 'CLOSED') title = "ğ‚ğ¥ğ¨ğ¬ğğ";
    else if (mode === 'RESERVE') title = "ğ‘ğğ¬ğğ«ğ¯ğğ";
    else if (mode === 'CALL') title = "ğğ¨ğ° ğ€ğ¯ğšğ¢ğ¥ğšğ›ğ¥ğ";
    else if (mode === 'WEEKLY') title = weeklyData.length === 0 ? "ğ‡ğ¨ğ¥ğ¢ğğšğ²" : "ğ–ğğğ¤ğ¥ğ² ğ’ğœğ¡ğğğ®ğ¥ğ";

    let result = (isEv === 'ç‰¹åˆ¥' ? evMark + "\n" : "") + `âœ¦ ${title} âœ¦\n`;
    
    if (mode === 'WEEKLY') {
        result += `\n${weeklyData.length > 0 ? 'ä»Šé€±ã®äºˆå®šã‚’ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚\n\n' + weeklyData.join('\n') : 'æœ¬æ—¥ã¯å®šä¼‘æ—¥ã‚’é ‚ã„ã¦ãŠã‚Šã¾ã™ã€‚'}\n`;
        let target = castNames.length > 0 ? castNames[0] : "å…¨å“¡";
        const pick = masterPhrases.find(p => p[0] === 'WEEKLY' && (isEv === 'CSV' || p[1] === isEv) && p[2] === target);
        if(pick) result += `\n${document.querySelector(`[data-val="${pick[2]}"]`)?.dataset.emoji || ""}ã€Œ${pick[3]}ã€\n`;
    } else {
        if(mode !== 'INFO'){
            const dVal = document.getElementById('openDate').value;
            const dRange = document.getElementById('dateRange').value;
            let displayDate = dRange ? dRange : (dVal ? `${dVal.split('-')[1]}/${dVal.split('-')[2]}` : "");
            if(displayDate) result += `ğŸ“… ${displayDate}\n`;
        }
        Array.from(document.querySelectorAll('.status-btn.active')).forEach(el => result += el.dataset.val + "\n");

        let body = document.getElementById('bodyPattern').value || "";
        let searchCast = (mode === 'RESERVE') ? currentLinkType + (castNames[0] || "å…¨å“¡") : (castNames[0] || "å…¨å“¡");
        const csvMatch = masterPhrases.find(p => p[0] === mode && (isEv === 'CSV' || p[1] === isEv) && p[2] === searchCast);
        if (csvMatch) body = csvMatch[3];

        const castDisp = castNames.length === 0 ? "â”€â”€ ä»Šå®µã€å…¨ã¦ã®ç½ªã‚’æƒãˆã¦ â”€â”€" : `æœ¬æ—¥ã®ç½ªï¼š${castEmojis.join('/')}`;
        result += '\n' + body.replace('[CASTS]', castDisp).replace('[H_URL]', document.getElementById('hpURL').value).replace('[R_URL]', document.getElementById('reserveURL').value) + '\n\n';
    }

    if(document.getElementById('freeNote').value) result += document.getElementById('freeNote').value + '\n';
    if((mode==='OPEN' || mode==='CALL') && document.getElementById('locType').value) result += `ğŸ“ ${document.getElementById('locType').value}\n`;
    
    result += `\n${shopTag}`;
    document.getElementById('resultText').value = result.trim().replace(/\n{3,}/g, '\n\n');
    document.getElementById('totalCount').innerText = document.getElementById('resultText').value.length;
}

window.onload = () => { 
    document.getElementById('openDate').value = new Date().toISOString().split('T')[0]; 
    loadData(); 
};
async function copyText() { 
    await navigator.clipboard.writeText(document.getElementById('resultText').value); 
    alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ"); 
}
</script>
</body>
</html>